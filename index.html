<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Caminhando na Palavra App</title>
  <style>
    :root{
      --bg-light:#f3f5ff;
      --bg-dark:#071226;
      --card-light:#ffffff;
      --card-dark:#0b1220;
      --text-light:#071128;
      --text-dark:#e6eef6;
      --accent:#4f46e5;
      --accent-2:#06b6d4;
      --muted-light:#6b7280;
      --muted-dark:#9ca3af;
      --glass: rgba(255,255,255,0.03);
      --radius:18px;
      --maxw:980px;
    }
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background:var(--bg-light);
      color:var(--text-light);
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding:20px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }
    body.dark{
      background:linear-gradient(180deg,#041428 0%, #071226 100%);
      color:var(--text-dark);
    }
    .wrap{
      width:100%;
      max-width:var(--maxw);
      margin:0 auto;
    }

    header.top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }
    .brand{display:flex;align-items:center;gap:12px}
    .logo{
      width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;
      background:linear-gradient(135deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 30px rgba(79,70,229,0.12)
    }
    h1{font-size:20px;margin:0}
    .sub{font-size:13px;color:var(--muted-light)}
    body.dark .sub{color:var(--muted-dark)}

    .grid{
      display:grid;
      grid-template-columns:1fr 380px;
      gap:18px;
    }

    .panel{
      background:var(--card-light);
      border-radius:var(--radius);
      padding:18px;
      box-shadow:0 10px 30px rgba(2,6,23,0.06);
    }
    body.dark .panel{background:var(--card-dark); box-shadow:0 8px 26px rgba(2,6,23,0.5)}

    .cards{display:flex;flex-direction:column;gap:12px}
    .card{
      display:flex;flex-direction:column;gap:8px;padding:16px;border-radius:14px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00));
      cursor:pointer;border:1px solid rgba(0,0,0,0.02);transition:transform .18s ease,box-shadow .18s ease;
    }
    .card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(15,23,42,0.08)}
    .card .title{font-weight:700;font-size:16px}
    .card .desc{font-size:13px;color:var(--muted-light)}
    body.dark .card .desc{color:var(--muted-dark)}

    .cta{
      display:flex;gap:8px;align-items:center;margin-top:14px;
    }
    .btn{
      padding:12px 18px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--accent),#7c5cff);color:#fff;font-weight:700;cursor:pointer;
      box-shadow:0 10px 30px rgba(79,70,229,0.12)
    }
    .btn.ghost{background:transparent;color:inherit;border:1px solid rgba(0,0,0,0.06)}
    body.dark .btn.ghost{border-color:rgba(255,255,255,0.04)}

    .aside{
      display:flex;flex-direction:column;gap:12px;
      position:relative;
    }

    .panel.small{padding:14px}

    .toggle{
      display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:10px;background:rgba(0,0,0,0.03);cursor:pointer;font-weight:600;
    }
    body.dark .toggle{background:rgba(255,255,255,0.03)}

    .loading{
      display:flex;align-items:center;gap:12px;justify-content:center;padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.00)));
      margin-top:12px;
    }
    .spinner{
      width:36px;height:36px;border-radius:50%;border:4px solid rgba(255,255,255,0.12);border-top-color:#fff;animation:spin 1s linear infinite;box-shadow:0 6px 20px rgba(0,0,0,0.08)
    }
    @keyframes spin{to{transform:rotate(360deg)}}

    .result-view{display:none;flex-direction:column;gap:12px}
    .result-view.active{display:flex}

    .dev-full{
      min-height:56vh;display:flex;flex-direction:column;gap:14px;justify-content:center;align-items:center;padding:20px;border-radius:16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)));
      text-align:center;
    }
    body.dark .dev-full{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01))}

    .dev-full h2{margin:0;font-size:20px}
    .dev-full p{margin:0;font-size:16px;line-height:1.6;color:var(--muted-light)}
    body.dark .dev-full p{color:var(--muted-dark)}

    .controls-bottom{display:flex;gap:10px;align-items:center;margin-top:10px}
    .progress{font-size:13px;color:var(--muted-light)}
    .nav-btn{
      padding:14px 18px;border-radius:12px;border:none;background:linear-gradient(90deg,#111827,#4f46e5);color:#fff;font-weight:700;font-size:15px;cursor:pointer;
    }
    .nav-btn.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:inherit}

    .save-note{font-size:13px;color:var(--muted-light);margin-top:8px}

    .controls-footer{display:flex;gap:8px;align-items:center;justify-content:space-between;margin-top:12px}
    .small-muted{font-size:13px;color:var(--muted-light)}

    @media(max-width:900px){
      .grid{grid-template-columns:1fr}
      .aside{order:2}
      .panel{order:1}
      .dev-full{min-height:48vh}
      .logo{width:48px;height:48px;font-size:20px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="top">
      <div class="brand">
        <div class="logo">ðŸ“–</div>
        <div>
          <h1>Caminhando na Palavra</h1>
          <div class="sub">Escolha um plano e receba 7 devocionais + 1 estudo semanal</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;align-items:center">
        <div class="toggle" id="themeToggle">Modo escuro</div>
      </div>
    </header>

    <div class="grid">
      <main class="panel">
        <div id="step-choose">
          <div style="font-weight:700;margin-bottom:8px">Escolha seu plano</div>
          <div class="cards" id="cards">
            <div class="card" data-plan="Crescimento espiritual">
              <div class="title">Crescimento espiritual</div>
              <div class="desc">Desenvolva maturidade cristÃ£ por meio das Escrituras.</div>
            </div>
            <div class="card" data-plan="Identidade em Cristo">
              <div class="title">Identidade em Cristo</div>
              <div class="desc">Descubra quem vocÃª Ã© em Cristo Ã  luz da BÃ­blia.</div>
            </div>
            <div class="card" data-plan="Vida de oraÃ§Ã£o">
              <div class="title">Vida de oraÃ§Ã£o</div>
              <div class="desc">Aprofunde sua comunhÃ£o com Deus por meio da oraÃ§Ã£o.</div>
            </div>
          </div>

          <div class="cta" style="margin-top:14px">
            <button class="btn" id="btnStart">Iniciar Plano</button>
            <button class="btn ghost" id="btnClearData">Limpar dados</button>
          </div>

          <div class="save-note">Os devocionais serÃ£o gerados automaticamente e salvos no seu dispositivo.</div>
        </div>

        <div id="step-result" class="result-view" aria-hidden="true">
          <div class="loading" id="loadingBox" style="display:none">
            <div class="spinner" aria-hidden="true"></div>
            <div>Gerando seu plano, aguarde...</div>
          </div>

          <div class="dev-full" id="devFull" style="display:none">
            <h2 id="devTitle">Devocional</h2>
            <p id="devText">â€”</p>

            <div class="controls-bottom" style="width:100%;max-width:720px;display:flex;justify-content:space-between">
              <div class="progress" id="progressText">1 / 7</div>
              <div style="display:flex;gap:8px">
                <button class="nav-btn ghost" id="btnPrev">Anterior</button>
                <button class="nav-btn" id="btnNext">PrÃ³ximo Devocional</button>
              </div>
            </div>
          </div>

          <div id="studyCard" style="display:none">
            <div class="dev-full" style="padding:18px">
              <h2>ðŸ“˜ Estudo Semanal</h2>
              <p id="studyText">â€”</p>
              <div style="margin-top:12px;display:flex;gap:8px;justify-content:center">
                <button class="nav-btn" id="btnFinish">Concluir Plano</button>
              </div>
            </div>
          </div>

        </div>
      </main>

      <aside class="aside">
        <div class="panel small">
          <div style="font-weight:700">Resumo</div>
          <div style="margin-top:8px" id="summaryPlan">Nenhum plano selecionado</div>
          <div class="small-muted" style="margin-top:8px">Status: <span id="status">Pronto</span></div>
        </div>

        <div class="panel small">
          <div style="font-weight:700">Progresso</div>
          <div style="margin-top:10px">
            <div class="small-muted">Devocionais</div>
            <div style="height:10px;background:rgba(0,0,0,0.04);border-radius:999px;margin-top:8px;overflow:hidden">
              <div id="bar" style="height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2))"></div>
            </div>
            <div style="margin-top:8px" id="progressSummary">0 / 7 concluÃ­dos</div>
          </div>
        </div>

        <div class="panel small">
          <div style="font-weight:700">AÃ§Ãµes</div>
          <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
            <button class="btn" id="btnOpenSaved">Abrir plano salvo</button>
            <button class="btn ghost" id="btnDownloadAll">Baixar devocionais (.txt)</button>
          </div>
        </div>
      </aside>
    </div>

    <footer style="margin-top:18px;text-align:center;color:var(--muted-light);font-size:13px">
      Â© Caminhando na Palavra
    </footer>
  </div>

  <script>
 const BACKEND = "https://caminhando-backend.onrender.com/generate";

/* -------------------------------------
   DOM ELEMENTS
------------------------------------- */
const bodyEl = document.body;
const themeToggle = document.getElementById('themeToggle');
const cards = Array.from(document.querySelectorAll('.card'));
const btnStart = document.getElementById('btnStart');
const btnClearData = document.getElementById('btnClearData');
const summaryPlan = document.getElementById('summaryPlan');
const statusEl = document.getElementById('status');
const loadingBox = document.getElementById('loadingBox');
const stepChoose = document.getElementById('step-choose');
const stepResult = document.getElementById('step-result');
const devFull = document.getElementById('devFull');
const devTitle = document.getElementById('devTitle');
const devText = document.getElementById('devText');
const progressText = document.getElementById('progressText');
const bar = document.getElementById('bar');
const progressSummary = document.getElementById('progressSummary');
const studyText = document.getElementById('studyText');
const btnPrev = document.getElementById('btnPrev');
const btnNext = document.getElementById('btnNext');
const btnFinish = document.getElementById('btnFinish');
const btnOpenSaved = document.getElementById('btnOpenSaved');
const btnDownloadAll = document.getElementById('btnDownloadAll');

/* -------------------------------------
   STATE
------------------------------------- */
let selectedPlan = null;
let devocionais = [];
let study = "";
let index = 0;
let completed = [];

/* -------------------------------------
   THEME
------------------------------------- */
function applyTheme(pref) {
  if (pref === 'dark' || (pref === 'auto' && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
    bodyEl.classList.add('dark');
    themeToggle.textContent = 'Modo claro';
  } else {
    bodyEl.classList.remove('dark');
    themeToggle.textContent = 'Modo escuro';
  }
}

applyTheme('auto');

themeToggle.addEventListener('click', () => {
  const dark = bodyEl.classList.toggle('dark');
  localStorage.setItem('theme', dark ? 'dark' : 'light');
  themeToggle.textContent = dark ? 'Modo claro' : 'Modo escuro';
});

const savedTheme = localStorage.getItem('theme');
if (savedTheme) applyTheme(savedTheme);

/* -------------------------------------
   SELECT PLAN
------------------------------------- */
cards.forEach(card =>
  card.addEventListener('click', () => {
    cards.forEach(c => (c.style.boxShadow = 'none'));
    card.style.boxShadow = '0 18px 40px rgba(49,46,129,0.12)';
    selectedPlan = card.dataset.plan;
    summaryPlan.textContent = selectedPlan;
  })
);

/* -------------------------------------
   START GENERATION
------------------------------------- */
btnStart.addEventListener("click", async () => {
  if (!selectedPlan) return alert("Escolha um plano primeiro.");

  stepChoose.style.display = "none";
  stepResult.classList.add("active");
  loadingBox.style.display = "flex";
  statusEl.textContent = "Gerando...";

  const payload = {
    plan: selectedPlan
  };

  try {
    const res = await fetch(BACKEND, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    if (!res.ok) throw new Error("Erro ao conectar no servidor.");

    const data = await res.json();

    devocionais = (data.devocionais || []).map(d => `${d.titulo}\n\n${d.conteudo}`);
    study = data.estudo_semanal?.conteudo || "";

    if (!devocionais.length) throw new Error("Nenhum devocional retornado.");

    index = 0;
    completed = new Array(devocionais.length).fill(false);

    saveToLocal();
    showDev(index);
    statusEl.textContent = "Gerado com sucesso âœ…";

  } catch (err) {
    console.error(err);

    // Fallback Local Se Offline
    const fallback = generateLocalFallback(selectedPlan);

</script>

</body>
</html>
